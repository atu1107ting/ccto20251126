<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŠ å¯†è²¨å¹£äº¤æ˜“å“¡æˆ°æƒ…å®¤ (Pro Max)</title>
    <style>
        /* å…¨å±€è¨­å®š */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #131722; /* TradingView æ·±è‰²èƒŒæ™¯ */
            color: #d1d4dc;
            height: 100vh;
            /* height: 100dvh;  é‡å°ç§»å‹•ç€è¦½å™¨å„ªåŒ–è¦–å£é«˜åº¦ */
            overflow: hidden; /* é˜²æ­¢æ•´å€‹é é¢æ»¾å‹• */
            display: flex;
            flex-direction: column;
        }

        /* é ‚éƒ¨å°èˆªåˆ— */
        header {
            height: 50px;
            background-color: #1e222d;
            border-bottom: 1px solid #2a2e39;
            display: flex;
            align-items: center;
            padding: 0 15px;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h1 {
            font-size: 16px;
            margin: 0;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .badge {
            background-color: #f23645;
            color: white;
            font-size: 11px;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .source-text {
            font-size: 12px; 
            color: #787b86;
            white-space: nowrap;
        }

        /* å¹£ç¨®åˆ‡æ›æŒ‰éˆ•å€ */
        .coin-nav {
            display: flex;
            gap: 5px;
        }

        .coin-btn {
            background-color: #2a2e39;
            border: 1px solid #363c4e;
            color: #d1d4dc;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .coin-btn:hover {
            background-color: #363c4e;
            color: #fff;
        }

        .coin-btn.active {
            background-color: #2962ff;
            color: white;
            border-color: #2962ff;
        }

        /* ä¸»ä½ˆå±€å®¹å™¨ */
        .main-container {
            display: flex;
            flex: 1; /* ä½”æ»¿å‰©é¤˜é«˜åº¦ */
            height: calc(100vh - 50px);
            overflow: hidden;
        }

        /* å·¦å´åœ–è¡¨å€ (65%) */
        .chart-section {
            flex: 65;
            border-right: 1px solid #2a2e39;
            position: relative;
        }

        /* å³å´åˆ†æå€ (35%) */
        .analysis-section {
            flex: 35;
            display: flex;
            flex-direction: column;
            background-color: #131722;
            overflow-y: auto; /* å…è¨±å³å´æ»¾å‹• */
            min-width: 350px; 
            -webkit-overflow-scrolling: touch; /* iOS æ»¾å‹•å„ªåŒ– */
        }

        /* åˆ†æå€å¡Šçš„æ¨™é¡Œ */
        .section-title {
            padding: 12px 20px;
            background-color: #1e222d;
            border-bottom: 1px solid #2a2e39;
            border-top: 1px solid #2a2e39;
            font-size: 15px;
            font-weight: bold;
            color: #fff;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .update-time {
            font-size: 11px;
            color: #787b86;
            font-weight: normal;
        }

        /* AI åˆ†æå¡ç‰‡æ¨£å¼ */
        .ai-card {
            padding: 20px;
            background-color: #1e222d;
            margin: 15px;
            border-radius: 8px;
            border: 1px solid #2a2e39;
            flex: 1; /* å¡«æ»¿å‰©é¤˜ç©ºé–“ */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 15px;
            min-height: min-content; /* é˜²æ­¢å…§å®¹è¢«å£“ç¸® */
        }

        .ai-price-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 5px;
            border-bottom: 1px solid #2a2e39;
            padding-bottom: 15px;
        }

        .current-price {
            font-size: 36px;
            font-weight: bold;
            color: #fff;
            line-height: 1.1;
            font-family: 'Roboto Mono', monospace; /* æ•¸å­—å°ˆç”¨å­—é«” */
            letter-spacing: -1px;
        }

        .price-label {
            font-size: 12px; 
            color: #787b86;
            margin-bottom: 4px;
        }

        .sr-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
            background: #232734;
            border-radius: 6px;
            overflow: hidden;
        }

        .sr-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #2a2e39;
        }
        
        .sr-table tr:last-child td {
            border-bottom: none;
        }

        .sr-label {
            color: #9db2bd;
            font-weight: 500;
        }

        .sr-value {
            text-align: right;
            font-family: 'Roboto Mono', monospace;
            font-weight: bold;
            font-size: 16px;
        }

        .color-res { color: #f23645; }
        .color-sup { color: #089981; }
        .color-pivot { color: #f7a600; }

        .ai-comment-box {
            background: #2a2e39;
            padding: 15px;
            border-radius: 6px;
            font-size: 15px;
            line-height: 1.5;
            color: #fff;
            border-left: 4px solid #2962ff;
        }

        .ai-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        
        .badge-bull { background: rgba(8, 153, 129, 0.2); color: #089981; }
        .badge-bear { background: rgba(242, 54, 69, 0.2); color: #f23645; }

        .tip {
            padding: 20px;
            font-size: 12px;
            color: #787b86;
            line-height: 1.5;
            border-top: 1px solid #2a2e39;
            flex-shrink: 0;
            background-color: #1e222d;
        }

        /* === æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ (Media Queries) === */
        @media (max-width: 768px) {
            /* 1. éš±è—é•·æ¨™é¡Œæ–‡å­—ï¼Œç¯€çœç©ºé–“ */
            h1 span:first-child {
                display: none;
            }
            .source-text {
                display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—ä¾†æºæ–‡å­— */
            }

            /* 2. èª¿æ•´æŒ‰éˆ•å¤§å° */
            .header-left { gap: 10px; }
            .coin-nav { gap: 4px; }
            .coin-btn { padding: 4px 10px; font-size: 12px; }

            /* 3. æ”¹ç‚ºå‚ç›´ä½ˆå±€ (ä¸Šä¸‹åˆ†å±¤) */
            .main-container {
                flex-direction: column;
            }

            /* 4. ä¸Šæ–¹åœ–è¡¨å€ (å›ºå®šé«˜åº¦ 50%) */
            .chart-section {
                flex: none;
                height: 50vh; /* ä½”æ“šä¸€åŠè¢å¹• */
                border-right: none;
                border-bottom: 2px solid #2a2e39; /* åˆ†éš”ç·šåŠ ç²— */
            }

            /* 5. ä¸‹æ–¹åˆ†æå€ (å‰©é¤˜ç©ºé–“ï¼Œå¯æ»¾å‹•) */
            .analysis-section {
                flex: 1; 
                min-width: 100%; /* å¯¬åº¦ä½”æ»¿ */
                padding-bottom: 20px; /* åº•éƒ¨ç•™ç™½ */
            }

            /* 6. èª¿æ•´å¡ç‰‡é–“è·èˆ‡å­—é«”ï¼Œé©æ‡‰æ‰‹æ©Ÿè¢å¹• */
            .ai-card {
                margin: 10px;
                padding: 15px;
                gap: 12px;
            }
            .current-price {
                font-size: 32px; /* ç¨å¾®ç¸®å°é˜²æ­¢æ›è¡Œ */
            }
            .sr-table {
                font-size: 14px;
            }
            .sr-table td {
                padding: 10px;
            }
            .ai-comment-box {
                font-size: 14px;
                padding: 12px;
            }
            .section-title {
                padding: 10px 15px;
                font-size: 14px;
            }
            .tip {
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨å°èˆª -->
    <header>
        <div class="header-left">
            <h1>
                <span>ğŸ“ˆ å°ˆæ¥­äº¤æ˜“é¢æ¿</span>
                <span class="badge">PRO</span>
            </h1>
            <!-- å¹£ç¨®åˆ‡æ›å€ -->
            <div class="coin-nav">
                <button class="coin-btn active" onclick="changeCoin('BTC')">BTC</button>
                <button class="coin-btn" onclick="changeCoin('ETH')">ETH</button>
                <button class="coin-btn" onclick="changeCoin('SOL')">SOL</button>
                <button class="coin-btn" onclick="changeCoin('XRP')">XRP</button>
            </div>
        </div>
        
        <div class="source-text">
            Binance Live
        </div>
    </header>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <div class="main-container">
        
        <!-- å€åŸŸ 1ï¼šKç·šåœ– (æ‰‹æ©Ÿç‰ˆåœ¨ä¸Šæ–¹) -->
        <div class="chart-section">
            <div class="tradingview-widget-container" style="height:100%;width:100%">
                <div id="tradingview_chart" style="height:100%;width:100%"></div>
            </div>
        </div>

        <!-- å€åŸŸ 2ï¼šAI åˆ†æ (æ‰‹æ©Ÿç‰ˆåœ¨ä¸‹æ–¹ï¼Œå¯æ»‘å‹•) -->
        <div class="analysis-section">
            
            <div class="section-title">
                <span>ğŸ¤– AI ç›¤é¢è§£æ (<span id="ai-coin-name">BTC</span>)</span>
                <span id="ai-status" class="update-time" style="color:#089981">â— é€£ç·šæ­£å¸¸</span>
            </div>
            
            <div class="ai-card">
                <div class="ai-price-header">
                    <div>
                        <div class="price-label">æœ€æ–°æˆäº¤åƒ¹ (USDT)</div>
                        <div class="current-price" id="current-price">Connecting...</div>
                    </div>
                    <div id="price-change" style="font-size:20px; font-weight:bold;">--%</div>
                </div>

                <table class="sr-table">
                    <tr>
                        <td class="sr-label">ğŸ”´ å£“åŠ› 2 (R2)</td>
                        <td class="sr-value color-res" id="val-r2">--</td>
                    </tr>
                    <tr>
                        <td class="sr-label">ğŸ”´ å£“åŠ› 1 (R1)</td>
                        <td class="sr-value color-res" id="val-r1">--</td>
                    </tr>
                    <tr>
                        <td class="sr-label">ğŸŸ¡ æ¨è»¸é» (Pivot)</td>
                        <td class="sr-value color-pivot" id="val-pp">--</td>
                    </tr>
                    <tr>
                        <td class="sr-label">ğŸŸ¢ æ”¯æ’ 1 (S1)</td>
                        <td class="sr-value color-sup" id="val-s1">--</td>
                    </tr>
                    <tr>
                        <td class="sr-label">ğŸŸ¢ æ”¯æ’ 2 (S2)</td>
                        <td class="sr-value color-sup" id="val-s2">--</td>
                    </tr>
                </table>

                <div class="ai-comment-box">
                    <div id="ai-badge" class="ai-badge badge-bull">åˆ†æè¼‰å…¥ä¸­</div>
                    <div id="ai-text">æ­£åœ¨è¨ˆç®—ä»Šæ—¥é—œéµé»ä½èˆ‡å¤šç©ºåŠ›é“...</div>
                </div>
            </div>

            <div class="tip">
                <strong>ğŸ’¡ æ“ä½œæç¤ºï¼š</strong><br>
                1. æ‰‹æ©Ÿç€è¦½æ™‚ï¼Œä¸ŠåŠéƒ¨å¯ç¸®æ”¾åœ–è¡¨ï¼Œä¸‹åŠéƒ¨å¯æ»‘å‹•æŸ¥çœ‹è©³ç´°åˆ†æã€‚<br>
                2. æ•¸æ“šä¾†è‡ª Binance å³æ™‚æˆäº¤æµï¼ŒPivot é»ä½æ¯æ—¥æ›´æ–°ã€‚
            </div>

        </div>
    </div>

    <!-- è…³æœ¬ -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        // === é…ç½®è¨­å®š ===
        const COINS = {
            'BTC': { tv: 'BINANCE:BTCUSDT', binance: 'BTCUSDT', ws: 'btcusdt' },
            'ETH': { tv: 'BINANCE:ETHUSDT', binance: 'ETHUSDT', ws: 'ethusdt' },
            'SOL': { tv: 'BINANCE:SOLUSDT', binance: 'SOLUSDT', ws: 'solusdt' },
            'XRP': { tv: 'BINANCE:XRPUSDT', binance: 'XRPUSDT', ws: 'xrpusdt' }
        };

        let currentCoin = 'BTC'; // ç•¶å‰é¸æ“‡
        let ws = null; // WebSocket å¯¦ä¾‹

        // === 1. å¹£ç¨®åˆ‡æ›é‚è¼¯ ===
        function changeCoin(coin) {
            if (currentCoin === coin) return; 
            currentCoin = coin;

            document.querySelectorAll('.coin-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.innerText === coin) btn.classList.add('active');
            });

            document.getElementById('ai-coin-name').innerText = coin;

            renderMainChart();
            fetchDailyData();
            startWebSocket();
        }

        // === 2. TradingView Widget æ¸²æŸ“ ===
        function renderMainChart() {
            // åµæ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿï¼Œè‹¥æ˜¯å‰‡éš±è—éƒ¨åˆ†å·¥å…·åˆ—ä»¥ç¯€çœç©ºé–“
            const isMobile = window.innerWidth <= 768;
            
            new TradingView.widget({
                "autosize": true,
                "symbol": COINS[currentCoin].tv,
                "interval": "60",
                "timezone": "Asia/Taipei",
                "theme": "dark",
                "style": "1",
                "locale": "zh_TW",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "withdateranges": true,
                "hide_side_toolbar": isMobile, // æ‰‹æ©Ÿç‰ˆéš±è—å´é‚Šç¹ªåœ–å·¥å…·
                "allow_symbol_change": true,
                "details": true,
                "studies": [
                    "RSI@tv-basicstudies",
                    "MASimple@tv-basicstudies" 
                ],
                "container_id": "tradingview_chart"
            });
        }

        // === 3. åˆå§‹åŒ– ===
        function initApp() {
            renderMainChart();
            fetchDailyData();
            startWebSocket();
        }

        // ç›£è½è¦–çª—å¤§å°æ”¹è®Šï¼Œé‡æ–°æ¸²æŸ“åœ–è¡¨ä»¥é©æ‡‰æ–°ä½ˆå±€
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(renderMainChart, 200);
        });

        // === 4. AI æ”¯æ’å£“åŠ›ä½ & æ•¸æ“šæµ ===
        let currentPrice = 0;
        let dayHigh = 0;
        let dayLow = 0;
        let dayClose = 0;

        async function fetchDailyData() {
            try {
                document.getElementById('ai-text').innerText = 'æ­£åœ¨åˆ†ææœ€æ–°å¸‚å ´çµæ§‹...';
                document.getElementById('ai-badge').innerText = 'è¨ˆç®—ä¸­';
                document.getElementById('ai-badge').className = 'ai-badge'; 

                const symbol = COINS[currentCoin].binance;
                const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                const data = await response.json();
                
                dayHigh = parseFloat(data.highPrice);
                dayLow = parseFloat(data.lowPrice);
                dayClose = parseFloat(data.prevClosePrice); 

                calculatePivotPoints();
            } catch (e) {
                console.error("Fetch data failed", e);
                document.getElementById('ai-text').innerText = "ç„¡æ³•é€£æ¥è‡³ Binance APIï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹ã€‚";
            }
        }

        function calculatePivotPoints() {
            if(dayHigh === 0) return;

            const pp = (dayHigh + dayLow + dayClose) / 3;
            const r1 = (2 * pp) - dayLow;
            const s1 = (2 * pp) - dayHigh;
            const r2 = pp + (dayHigh - dayLow);
            const s2 = pp - (dayHigh - dayLow);

            let decimals = 2;
            if (currentCoin === 'XRP') decimals = 4;
            if (currentCoin === 'SOL') decimals = 3;
            if (currentCoin === 'BTC') decimals = 0;

            document.getElementById('val-r2').innerText = r2.toFixed(decimals);
            document.getElementById('val-r1').innerText = r1.toFixed(decimals);
            document.getElementById('val-pp').innerText = pp.toFixed(decimals);
            document.getElementById('val-s1').innerText = s1.toFixed(decimals);
            document.getElementById('val-s2').innerText = s2.toFixed(decimals);

            updateAnalysis(pp, r1, s1);
        }

        function startWebSocket() {
            if (ws) {
                ws.close();
            }

            const streamName = COINS[currentCoin].ws;
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${streamName}@ticker`);
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.c);
                const change = parseFloat(data.P);
                
                currentPrice = price;
                
                const priceEl = document.getElementById('current-price');
                if (price < 10) priceEl.innerText = price.toFixed(4);
                else if (price < 1000) priceEl.innerText = price.toFixed(2);
                else priceEl.innerText = Math.floor(price).toLocaleString();
                
                priceEl.style.color = change >= 0 ? '#089981' : '#f23645';

                const changeEl = document.getElementById('price-change');
                changeEl.innerText = (change >= 0 ? '+' : '') + change + '%';
                changeEl.style.color = change >= 0 ? '#089981' : '#f23645';

                const ppStr = document.getElementById('val-pp').innerText;
                if (ppStr !== '--') {
                    const pp = parseFloat(ppStr.replace(/,/g, ''));
                    const r1 = parseFloat(document.getElementById('val-r1').innerText.replace(/,/g, ''));
                    const s1 = parseFloat(document.getElementById('val-s1').innerText.replace(/,/g, ''));
                    updateAnalysis(pp, r1, s1);
                }
            };
            
            ws.onopen = () => { document.getElementById('ai-status').innerText = "â— é€£ç·šæ­£å¸¸"; document.getElementById('ai-status').style.color = "#089981"; };
            ws.onerror = () => { document.getElementById('ai-status').innerText = "â— é€£ç·šä¸­æ–·"; document.getElementById('ai-status').style.color = "red"; };
        }

        function updateAnalysis(pp, r1, s1) {
            const badge = document.getElementById('ai-badge');
            const text = document.getElementById('ai-text');
            const coin = currentCoin;
            
            let decimals = 2;
            if (currentCoin === 'BTC') decimals = 0;
            
            const fR1 = r1.toFixed(decimals);
            const fS1 = s1.toFixed(decimals);
            const fPP = pp.toFixed(decimals);

            if (currentPrice > r1) {
                badge.className = "ai-badge badge-bull";
                badge.innerText = "ğŸš€ å¼·å‹¢çªç ´";
                text.innerText = `${coin} åƒ¹æ ¼å·²å¼·å‹¢çªç ´ R1 å£“åŠ›ä½ ${fR1}ï¼Œå¤šé ­å‹•èƒ½æ¥µå¼·ã€‚éœ€ç•™æ„ R2 æ˜¯å¦æœ‰ç²åˆ©äº†çµè³£å£“ï¼Œè‹¥æŒçºŒç«™ç©© R1 å‰‡çœ‹æ¼²ä¸è®Šã€‚`;
            } else if (currentPrice > pp) {
                badge.className = "ai-badge badge-bull";
                badge.innerText = "ğŸ“ˆ åå¤šéœ‡ç›ª";
                text.innerText = `${coin} ç›®å‰ä½æ–¼ä¸­è»¸ ${fPP} ä¹‹ä¸Šï¼Œæ•´é«”è¶¨å‹¢åå¤šã€‚åªè¦ä¸è·Œç ´ä¸­è»¸ Pivotï¼Œå›èª¿çš†å¯è¦–ç‚ºæ½›åœ¨è²·é»ï¼Œä¸Šæ–¹ç›®æ¨™çœ‹å‘ R1ã€‚`;
            } else if (currentPrice < s1) {
                badge.className = "ai-badge badge-bear";
                badge.innerText = "ğŸ“‰ å¼±å‹¢æ¢åº•";
                text.innerText = `${coin} å·²è·Œç ´ S1 æ”¯æ’ ${fS1}ï¼Œç©ºé ­å®Œå…¨ä¸»å°å¸‚å ´ã€‚è«‹å‹¿è¼•æ˜“çŒœåº•ï¼Œä¸‹æ–¹ S2 æ”¯æ’éœ€å¯†åˆ‡é—œæ³¨æ˜¯å¦æœ‰æ­¢è·Œè¨Šè™Ÿã€‚`;
            } else {
                badge.className = "ai-badge badge-bear";
                badge.innerText = "ğŸ» åç©ºéœ‡ç›ª";
                text.innerText = `${coin} ä½æ–¼ä¸­è»¸ ${fPP} ä¹‹ä¸‹ï¼ŒçŸ­æœŸæ‰¿å—è³£å£“ã€‚åå½ˆè‹¥ç„¡æ³•ç«™å›ä¸­è»¸ï¼Œå‰‡è¶¨å‹¢ä»ä»¥é«˜ç©ºç‚ºä¸»ï¼Œä¸‹æ–¹ç›®æ¨™ S1ã€‚`;
            }
        }

        initApp();
        setInterval(fetchDailyData, 600000);

    </script>

</body>
</html>